== Publishing JBT update sites for QE ==

0. Set the URLs in the discovery site so they point to the correct versions:

  https://jenkins.mw.lab.eng.bos.redhat.com/hudson/view/DevStudio/view/DevStudio_7.0.kepler/job/jbosstools-discovery_41/configure

    http://download.jboss.org/jbosstools/updates/staging/JBossTools-4.1.2.CR1c.core/ # a, b, c...
    http://www.qa.jboss.com/binaries/RHDS/updates/development/7.1.1.CR1c.core/ # a, b, c...

  Respin.
  
=== Builds ===

1. Move the latest JBT & Web Tools nightly builds (no symlinks to avoid accidental cleanup):

	version=4.1.2.CR1c # a, b, c...
	branch=core/4.1.kepler
	buildID1=$(echo "ls 20*" | sftp tools@filemgmt.jboss.org:/downloads_htdocs/tools/builds/nightly/${branch} 2>&1 | grep "20.\+" | grep -v sftp | sort | tail -1); buildID1=${buildID1%%/*}
	echo "Latest build: ${buildID1}"
	echo "mkdir development/${version}.core" | sftp tools@filemgmt.jboss.org:/downloads_htdocs/tools/builds
	echo "rename nightly/${branch}/${buildID1} development/${version}.core/${buildID1}" | sftp tools@filemgmt.jboss.org:/downloads_htdocs/tools/builds
	
  version=4.1.2.CR1c # a, b, c...
  branch=coretests/4.1.kepler
  buildID2=$(echo "ls 20*" | sftp tools@filemgmt.jboss.org:/downloads_htdocs/tools/builds/nightly/${branch} 2>&1 | grep "20.\+" | grep -v sftp | sort | tail -1); buildID2=${buildID2%%/*}
  echo "Latest build: ${buildID2}"
  echo "mkdir development/${version}.coretests" | sftp tools@filemgmt.jboss.org:/downloads_htdocs/tools/builds
  echo "rename nightly/${branch}/${buildID2} development/${version}.coretests/${buildID2}" | sftp tools@filemgmt.jboss.org:/downloads_htdocs/tools/builds
  
  version=4.1.2.CR1c # a, b, c...
  branch=webtools/4.1.kepler
  buildID3=$(echo "ls 20*" | sftp tools@filemgmt.jboss.org:/downloads_htdocs/tools/builds/nightly/${branch} 2>&1 | grep "20.\+" | grep -v sftp | sort | tail -1); buildID3=${buildID3%%/*}
  echo "Latest build: ${buildID3}"
  echo "mkdir development/${version}.webtools" | sftp tools@filemgmt.jboss.org:/downloads_htdocs/tools/builds
  echo "rename nightly/${branch}/${buildID3} development/${version}.webtools/${buildID3}" | sftp tools@filemgmt.jboss.org:/downloads_htdocs/tools/builds
  
  echo " >> http://download.jboss.org/jbosstools/builds/development/${version}.core/${buildID1}" | egrep ">>|${version}"
	echo " >> http://download.jboss.org/jbosstools/builds/development/${version}.coretests/${buildID2}" | egrep ">>|${version}"
  echo " >> http://download.jboss.org/jbosstools/builds/development/${version}.webtools/${buildID3}" | egrep ">>|${version}"

=== Update Sites ===

2. Move the latest JBT, Web Tools, and Discovery update sites (no symlinks to avoid accidental overwrites):

	version=4.1.2.CR1c # a, b, c...
  branch=core/4.1.kepler;   echo "rename nightly/${branch} staging/JBossTools-${version}.core" | sftp tools@filemgmt.jboss.org:/downloads_htdocs/tools/updates
  echo " >> http://download.jboss.org/jbosstools/updates/staging/JBossTools-${version}.core/" | egrep ">>|${version}"

  branch=coretests/4.1.kepler;   echo "rename nightly/${branch} staging/JBossTools-${version}.coretests" | sftp tools@filemgmt.jboss.org:/downloads_htdocs/tools/updates
  echo " >> http://download.jboss.org/jbosstools/updates/staging/JBossTools-${version}.coretests/" | egrep ">>|${version}"

  branch=webtools/4.1.kepler;   echo "rename nightly/${branch} staging/JBossTools-${version}.webtools" | sftp tools@filemgmt.jboss.org:/downloads_htdocs/tools/updates
  echo " >> http://download.jboss.org/jbosstools/updates/staging/JBossTools-${version}.webtools/" | egrep ">>|${version}"

  # Make sure that the parameters fed into the Discovery job are correct; respin if necessary.
  # https://jenkins.mw.lab.eng.bos.redhat.com/hudson/view/DevStudio/view/DevStudio_7.0.kepler/job/jbosstools-discovery_41/configure

  branch=core/4.1.kepler;   echo "rename nightly/${branch} development/${version}" | sftp tools@filemgmt.jboss.org:/downloads_htdocs/tools/discovery/
  echo " >> http://download.jboss.org/jbosstools/discovery/development/${version}/" | egrep ">>|${version}"

3. To preserve a copy of the nightly sites after the move:

  ssh to dev01.mw.lab.eng.bos.redhat.com, sudo to hudson user, then
 
  alias   scpr='rsync -aPrz --rsh=ssh --protocol=28'

  # can run these in parallel 

  version=4.1.2.CR1c # a, b, c...
  branch=core/4.1.kepler
  scpr tools@filemgmt.jboss.org:/downloads_htdocs/tools/updates/staging/JBossTools-${version}.core/* /tmp/JBossTools-${version}.core/
  scpr /tmp/JBossTools-${version}.core/* tools@filemgmt.jboss.org:/downloads_htdocs/tools/updates/nightly/${branch}/ --delete
  rm -fr /tmp/JBossTools-${version}.core/
  echo " >> http://download.jboss.org/jbosstools/updates/nightly/${branch}/" | egrep ">>|${branch}"

  version=4.1.2.CR1c # a, b, c...
  branch=coretests/4.1.kepler
  scpr tools@filemgmt.jboss.org:/downloads_htdocs/tools/updates/staging/JBossTools-${version}.coretests/* /tmp/JBossTools-${version}.coretests/
  scpr /tmp/JBossTools-${version}.coretests/* tools@filemgmt.jboss.org:/downloads_htdocs/tools/updates/nightly/${branch}/ --delete
  rm -fr /tmp/JBossTools-${version}.coretests/
  echo " >> http://download.jboss.org/jbosstools/updates/nightly/${branch}/" | egrep ">>|${branch}"

  version=4.1.2.CR1c # a, b, c...
  branch=webtools/4.1.kepler
  scpr tools@filemgmt.jboss.org:/downloads_htdocs/tools/updates/staging/JBossTools-${version}.webtools/* /tmp/JBossTools-${version}.webtools/
  scpr /tmp/JBossTools-${version}.webtools/* tools@filemgmt.jboss.org:/downloads_htdocs/tools/updates/nightly/${branch}/ --delete
  rm -fr /tmp/JBossTools-${version}.webtools/
  echo " >> http://download.jboss.org/jbosstools/updates/nightly/${branch}/" | egrep ">>|${branch}"

  # Make sure that the parameters fed into the Discovery job are correct; respin if necessary.
  # https://jenkins.mw.lab.eng.bos.redhat.com/hudson/view/DevStudio/view/DevStudio_7.0.kepler/job/jbosstools-discovery_41/configure

  version=4.1.2.CR1c # a, b, c...
  branch=core/4.1.kepler
  scpr tools@filemgmt.jboss.org:/downloads_htdocs/tools/discovery/development/${version}/* /tmp/JBossTools-${version}.discovery/
  scpr /tmp/JBossTools-${version}.discovery/* tools@filemgmt.jboss.org:/downloads_htdocs/tools/discovery/nightly/${branch}/ --delete
  rm -fr /tmp/JBossTools-${version}.discovery/
  echo " >> http://download.jboss.org/jbosstools/discovery/nightly/${branch}/" | egrep ">>|${branch}"

---

Note that 
  sftp://tools@filemgmt.jboss.org/downloads_htdocs/tools/ 
    maps to 
  http://download.jboss.org/jbosstools/

If you do not need it urgently, you can push files there simply by committing changes to Git here:
  https://github.com/jbosstools/jbosstools-download.jboss.org/tree/master/jbosstools
This is controlled by Hudson job here:
  https://jenkins.mw.lab.eng.bos.redhat.com/hudson/view/DevStudio/view/DevStudio_All/job/jbosstools-download.jboss.org-rsync-from-svn/

--------------------------------------------

== EMAIL TEMPLATES ==

SEND 2 emails: 
1 to jbosstools-dev, and 
1 to internal addresses (to avoid accidentally sending internal info to external address)

# 1. To:   "jbosstools-dev@lists.jboss.org"
# 2. To:  jbds-pm-list <jbds-pm-list@redhat.com>, "external-exadel-list@redhat.com" <external-exadel-list@redhat.com>

version=4.1.2.CR1c # a, b, c...
respin="respin-c"
TARGET_PLATFORM_VERSION_MIN=4.30.6.Final
TARGET_PLATFORM_VERSION_MAX=4.32.0.Final
TARGET_PLATFORM_CENTRAL_MAX=4.31.0.Final
version2=7.1.1.CR1 # no respin suffix here
version3=4.1.2.CR1 # no respin suffix here
echo "
Subject: 

JBoss Tools Core ${version} bits available for QE testing

Body:

As always, these are not FINAL bits, but preliminary results for QE testing. Not for redistribution to customers. 


JBoss Tools Target Platforms:

http://download.jboss.org/jbosstools/targetplatforms/jbosstoolstarget/kepler/ (JBoss Tools - current release)
http://download.jboss.org/jbosstools/targetplatforms/jbosstoolstarget/${TARGET_PLATFORM_VERSION_MAX} (JBoss Tools - upcoming milestone)

(This is loaded automatically into Eclipse when installing JBoss Tools. Provided here simply for reference.)


Update Sites (Staging):

http://download.jboss.org/jbosstools/updates/staging/JBossTools-${version}.core/
http://download.jboss.org/jbosstools/updates/staging/JBossTools-${version}.coretests/
http://download.jboss.org/jbosstools/updates/staging/JBossTools-${version}.webtools/


Builds:

http://download.jboss.org/jbosstools/builds/development/${version}.core/${buildID1}
http://download.jboss.org/jbosstools/builds/development/${version}.coretests/${buildID2}
http://download.jboss.org/jbosstools/builds/development/${version}.webtools/${buildID3}


JBoss Central:

http://download.jboss.org/jbosstools/targetplatforms/jbtcentraltarget/kepler/ (JBoss Central - current release)
http://download.jboss.org/jbosstools/targetplatforms/jbtcentraltarget/${TARGET_PLATFORM_CENTRAL_MAX}/ (JBoss Central - upcoming milestone)

To test the upcoming version of Central, add this to your eclipse.ini file after the -vmargs line:

-Djboss.discovery.directory.url=http://download.jboss.org/jbosstools/discovery/development/${version}/jbosstools-directory.xml
     -Djboss.discovery.site.url=http://download.jboss.org/jbosstools/discovery/development/${version}/

--

New + Noteworthy:

Subject to change, the latest N&N is here:

http://htmlpreview.github.com/?https://raw.github.com/jbosstools/jbosstools-documentation/master/whatsnew/index.html
  and
http://docs.jboss.org/tools/whatsnew/

--

Schedule / Upcoming Releases:

https://issues.jboss.org/browse/JBIDE#selectedTab=com.atlassian.jira.plugin.system.project%3Aversions-panel

"
if [[ $respin != "respin-" ]]; then
echo " 

--

Changes prompting this $respin are:
"'
https://issues.jboss.org/issues/?jql=labels%20in%20%28%22'${respin}'%22%29%20and%20%28%28project%20in%20%28%22JBDS%22%29%20and%20fixversion%20in%20%28%22'${version2}'%22%29%29%20or%20%28project%20in%20%28%22JBIDE%22%2C%22TOOLSDOC%22%29%20and%20fixversion%20in%20%28%22'${version3}'%22%29%29%29
'
fi
