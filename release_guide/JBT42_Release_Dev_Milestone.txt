# "gw1" uses special aliases/scripts/shortcuts. Basically, we want to follow correct github workflows so that commits are pushed to user's fork, then later pull-requested (and the PR applied)
# "gw2" will create the PR, "gw3" will apply it, and "gw4" will delete the topic branch locally and in my fork
# the 4 steps are captured here: https://gist.github.com/nickboldt/4111850
# "stat" is short for "git status"; "gd" is short for "git diff"; "ga" is short for "git add"


##############################################################################
#### 
#### TODO JBIDE-13283 incorporate publishing to Akamai for update sites & zips: use
#### http://download.jboss.org/jbosstools/static/releases/ instead of 
#### http://download.jboss.org/jbosstools/updates/
#### 
##############################################################################


0. Launch Sourceforge SSH session

 ssh -t nickboldt,jboss@shell.sourceforge.net create # wait until this is done, then see step 2.
 
1. Move/rename 4 files (2 zips, 2 md5sums) into http://download.jboss.org/jbosstools/builds/development/sf.net/

  stream=42
  version=4.2.0.Alpha1
  version2=4.2.0.Alpha1; # a, b...
  buildID1=$(echo "ls 20*" | sftp tools@filemgmt.jboss.org:/downloads_htdocs/tools/builds/development/${version2}.core/ 2>&1 | grep "20.\+" | grep -v sftp | sort | tail -1); buildID1=${buildID1%%/*}
  echo "Latest build: ${buildID1}"

# TODO: Hibernate tools zip is now built here:
# https://jenkins.mw.lab.eng.bos.redhat.com/hudson/job/jbosstools-build-sites.aggregate.hibernatetools-site_4.2.luna/
# And located here:
# http://download.jboss.org/jbosstools/builds/staging/jbosstools-build-sites.aggregate.hibernatetools-site_master/all/jbosstools-build-sites.aggregate.hibernatetools-site_master-Update-SNAPSHOT.zip

  echo "mkdir development/sf.net/${version}" | sftp tools@filemgmt.jboss.org:/downloads_htdocs/tools/builds
  #echo "rename development/${version2}.core/${buildID1}/components/jbosstools-hibernate_${stream}-Update-SNAPSHOT.zip                   development/sf.net/${version}/hibernatetools-Update-${version}_${buildID1}.zip"     | sftp tools@filemgmt.jboss.org:/downloads_htdocs/tools/builds
  #echo "rename development/${version2}.core/${buildID1}/components/jbosstools-hibernate_${stream}-Update-SNAPSHOT.zip.MD5               development/sf.net/${version}/hibernatetools-Update-${version}_${buildID1}.zip.MD5" | sftp tools@filemgmt.jboss.org:/downloads_htdocs/tools/builds
  echo "rename development/${version2}.core/${buildID1}/all/jbosstools-build-sites.aggregate.site_${stream}-Update-${buildID1}.zip      development/sf.net/${version}/jbosstools-Update-${version}_${buildID1}.zip"         | sftp tools@filemgmt.jboss.org:/downloads_htdocs/tools/builds
  echo "rename development/${version2}.core/${buildID1}/all/jbosstools-build-sites.aggregate.site_${stream}-Update-${buildID1}.zip.MD5  development/sf.net/${version}/jbosstools-Update-${version}_${buildID1}.zip.MD5"     | sftp tools@filemgmt.jboss.org:/downloads_htdocs/tools/builds
  echo "rename development/${version2}.core/${buildID1}/all/jbosstools-build-sites.aggregate.site_${stream}-Sources-${buildID1}.zip     development/sf.net/${version}/jbosstools-Sources-${version}_${buildID1}.zip"        | sftp tools@filemgmt.jboss.org:/downloads_htdocs/tools/builds
  echo "rename development/${version2}.core/${buildID1}/all/jbosstools-build-sites.aggregate.site_${stream}-Sources-${buildID1}.zip.MD5 development/sf.net/${version}/jbosstools-Sources-${version}_${buildID1}.zip.MD5"    | sftp tools@filemgmt.jboss.org:/downloads_htdocs/tools/builds

  # now get file sizes for use with Magnolia site later (www.jboss.org/tools)
  wget -q http://download.jboss.org/jbosstools/builds/development/sf.net/${version} -k -O /tmp/index.html
  echo "  >>>  http://download.jboss.org/jbosstools/builds/development/sf.net/${version}/"
  for f in $(cat /tmp/index.html | egrep -v "C=D|title>|h1>" | egrep "${version}"); do
    if [[ ${f/zip/} != ${f} ]]; then 
      echo -n "  "
      echo -n $f | sed 's#.\+href="\([^"]\+\)".\+#\1#g' | sed "s#.\+${version}/##g" | sed 's#".\+##g';
      if [[ ${f/MD5/} != ${f} ]]; then echo ""; echo ""; fi
    fi
    if [[ ${f/M</} != ${f} ]]; then echo -n " :: "; echo $f | sed 's#.\+>\([^<>]\)#\1#g' | sed 's#\([^<>]\)<.\+#\1#g'; fi
  done
  rm -f /tmp/index.html

  # end up with somtehing like this:
  # omit hibernate tools zip and see if anyone notices
  #hibernatetools-Update-4.2.0.Alpha1_2013-11-24_01-06-56-B575.zip :: 78M
  #hibernatetools-Update-4.2.0.Alpha1_2013-11-24_01-06-56-B575.zip.MD5

  jbosstools-Sources-4.2.0.Alpha1_2013-11-24_01-06-56-B575.zip :: 93M
  jbosstools-Sources-4.2.0.Alpha1_2013-11-24_01-06-56-B575.zip.MD5

  jbosstools-Update-4.2.0.Alpha1_2013-11-24_01-06-56-B575.zip :: 418M
  jbosstools-Update-4.2.0.Alpha1_2013-11-24_01-06-56-B575.zip.MD5

2. Pull files to SF after logging in via SSH (Downloaded: 8 files, 353M in 4m 22s (1.35 MB/s)):

  #ssh -t nickboldt,jboss@shell.sourceforge.net create # if not done above already!
  version=4.2.0.x # if this is a Final or build, use 4.2.x instead of 4.2.0.x
  version2=4.2.0.Alpha1
  mkdir -p /home/users/n/ni/nickboldt/jboss/JBossTools/JBossTools${version}
  cd /home/users/n/ni/nickboldt/jboss/JBossTools/JBossTools${version}
  wget http://download.jboss.org/jbosstools/builds/development/sf.net/${version2} -k -O /tmp/index.html
  for f in $(cat /tmp/index.html | egrep -v "C=D|title>|h1>" | egrep "${version2}" | sed 's#.\+href="\([^"]\+\)".\+#\1#g'); do wget -nc $f; done
  rm -f /tmp/index.html
  exit
  
* While uploading... *
  
3. Create release notes file & rename, then upload to sf.net:
    https://issues.jboss.org/secure/ConfigureReport!default.jspa?selectedProjectId=10020&projectOrFilterId=project-10020&projectOrFilterName=Tools%20%28JBoss%20Tools%29&reportKey=org.jboss.labs.jira.plugin.release-notes-report-plugin:releasenotes
  --> select release ("4.2.0.Alpha1"), type of issues ("All"), and style ("HTML").
  --> select text and paste into file.

  version=4.2.0.x # if this is a Final build, use 4.2.x instead of 4.2.0.x
  version2=4.2.0.Alpha1
  cd /home/nboldt/truu/doc/release_guide/ # in devstudio SVN
  prev=$(find . -name "zz_Release_Notes_4.2*"); prev=${prev:2}; echo $prev
  sublime zz_Release_Notes_4.2.0*.html # or use gedit, vim, etc.
  git mv zz_Release_Notes_4.2.0*.html zz_Release_Notes_${version2}.readme.html
  # for milestones
  scp /home/nboldt/truu/doc/release_guide/zz_Release_Notes_${version2}.readme.html "nickboldt,jboss@frs.sourceforge.net:/home/frs/project/j/jb/jboss/JBossTools/JBossTools4.2.0.x/"
  # or, for Final builds
  scp /home/nboldt/truu/doc/release_guide/zz_Release_Notes_${version2}.readme.html "nickboldt,jboss@frs.sourceforge.net:/home/frs/project/j/jb/jboss/JBossTools/JBossTools4.2.x/"

  echo ">>> http://sourceforge.net/projects/jboss/files/JBossTools/JBossTools${version}/zz_Release_Notes_${version2}.readme.html/download"

  topic="release-${version2}"; branch=master; gw1
  ci "generate release notes for ${version2} release" ${prev} zz_Release_Notes_${version2}.readme.html .
  gw2;gw3;gw4

4. Check contents of bookmarks.xml file, and upload to sf.net if changed:

  sublime  /home/nboldt/truu/doc/release_guide/jbosstools4.2_bookmarks.xml
  scp /home/nboldt/truu/doc/release_guide/jbosstools4.2_bookmarks.xml "nickboldt,jboss@frs.sourceforge.net:/home/frs/project/j/jb/jboss/JBossTools/"
----

5. Tweak magnolia pages to link to new files, but do not publish yet

  firefox \
  https://www.jboss.org/author/tools/download
  firefox \
  https://www.jboss.org/author/tools/download/dev \
  https://www.jboss.org/author/tools/download/stable \
  https://www.jboss.org/author/tools/download/installation/update_4_2

  # for Final builds, copy dev/4_2 into stable/4_2, update other pages accordingly.

----

6. (ONLY if necessary) Move Milestonex to Milestone

  version=4.2.0.Alpha1
  version2=4.2.0.Alpha1 # a, b, c, d...

  # rename discovery site, http://download.jboss.org/jbosstools/discovery/development/${version2}/
  echo "rename development/${version}  development/${version}.DELETEME" | sftp tools@filemgmt.jboss.org:/downloads_htdocs/tools/discovery
  echo "rename development/${version2} development/${version}" | sftp tools@filemgmt.jboss.org:/downloads_htdocs/tools/discovery

  # rename the development build
  echo "rename development/${version}.core  development/${version}.core.DELETEME" | sftp tools@filemgmt.jboss.org:/downloads_htdocs/tools/builds
  echo "rename development/${version2}.core development/${version}.core" | sftp tools@filemgmt.jboss.org:/downloads_htdocs/tools/builds

  # make sure this exists - might be only "a" while core is on "c"
  echo "rename development/${version}.coretests  development/${version}.coretests.DELETEME" | sftp tools@filemgmt.jboss.org:/downloads_htdocs/tools/builds
  echo "rename development/${version2}.coretests development/${version}.coretests" | sftp tools@filemgmt.jboss.org:/downloads_htdocs/tools/builds

  # make sure this exists - might be only "a" while core is on "c"
  echo "rename development/${version}.webtools  development/${version}.webtools.DELETEME" | sftp tools@filemgmt.jboss.org:/downloads_htdocs/tools/builds
  echo "rename development/${version2}.webtools development/${version}.webtools" | sftp tools@filemgmt.jboss.org:/downloads_htdocs/tools/builds

  # rename the update site
  echo "rename JBossTools-${version}.core  JBossTools-${version}.core.DELETEME" | sftp tools@filemgmt.jboss.org:/downloads_htdocs/tools/updates
  echo "rename JBossTools-${version2}.core JBossTools-${version}.core" | sftp tools@filemgmt.jboss.org:/downloads_htdocs/tools/updates

  # make sure this exists - might be only "a" while core is on "c"
  echo "rename JBossTools-${version}.coretests  JBossTools-${version}.coretests.DELETEME" | sftp tools@filemgmt.jboss.org:/downloads_htdocs/tools/updates
  echo "rename JBossTools-${version2}.coretests JBossTools-${version}.coretests" | sftp tools@filemgmt.jboss.org:/downloads_htdocs/tools/updates

  # make sure this exists - might be only "a" while core is on "c"
  echo "rename JBossTools-${version}.webtools  JBossTools-${version}.webtools.DELETEME" | sftp tools@filemgmt.jboss.org:/downloads_htdocs/tools/updates
  echo "rename JBossTools-${version2}.webtools JBossTools-${version}.webtools" | sftp tools@filemgmt.jboss.org:/downloads_htdocs/tools/updates

  Also, over sftp, delete any old iterations (*.DELETEME) or previous respins that are no longer needed from 

  * tools/discovery/development/
  * tools/updates/JBossTools-*
  * tools/builds/development/

7. Publish new Web Tools site:

  alias   ga='git add'
  alias   stat='git status'
  alias   gd='git diff --color=always -w'
  alias   scpr='rsync -aPrz --rsh=ssh'
  alias   ci='git commit -m'

  previous=4.1.1.Final
  version=4.2.0.Final # only use a, b suffix if did not perform rename in step 6 above
  #echo "rename webtools/luna webtools/luna.`date +%Y%m%d-%H%M`" | sftp tools@filemgmt.jboss.org:/downloads_htdocs/tools/updates/
  echo "rename webtools/luna webtools/luna_${previous}"         | sftp tools@filemgmt.jboss.org:/downloads_htdocs/tools/updates/
  echo "rename JBossTools-${version}.webtools webtools/luna"      | sftp tools@filemgmt.jboss.org:/downloads_htdocs/tools/updates/
  cd ~/tru/download.jboss.org/jbosstools/updates/webtools/luna/
  rm -f index.html site.xml
  # sometimes the website is slow to refresh, so pull over sftp instead 
  #wget -N http://download.jboss.org/jbosstools/updates/webtools/luna/index.html
  #wget -N http://download.jboss.org/jbosstools/updates/webtools/luna/site.xml
  scpr tools@filemgmt.jboss.org:/downloads_htdocs/tools/updates/webtools/luna/index.html .
  scpr tools@filemgmt.jboss.org:/downloads_htdocs/tools/updates/webtools/luna/site.xml .

  stat .; gd .
  topic="release-${version2}"; branch=master; gw1
  ci "release ${version} (${version2}) to http://download.jboss.org/jbosstools/updates/webtools/luna/" index.html site.xml
  gw2;gw3;gw4

  Also, over sftp, delete any old iterations or respins that are no longer needed.

  ** If this is the first milestone release, ensure that upstream project Web Tools (WTP) knows to include this new URL in their server adapter wizard. New bugzilla required! **


8. [4 files] Update latest released target platform site.

  ** MAY NOT NEED TO DO THIS AGAIN UNTIL AFTER GA **

  version=4.2.0.Alpha1

  OLD_JBT_JBDS_TP=4.40.0.Alpha1
  NEW_JBT_JBDS_TP=4.40.0.Alpha1

  OLD_CENTRAL_TP=4.40.0.Alpha1
  NEW_CENTRAL_TP=4.40.0.Alpha1

  pushd ~/tru/download.jboss.org/
  topic="release-target-platform-for-${version}"; branch=master; gw1

  # JBT
  pushd ~/tru/download.jboss.org/jbosstools/targetplatforms/jbosstoolstarget/luna/
  now=`date +%s000`
  for d in composite*.xml; do
  sed -i -e "s#${OLD_JBT_JBDS_TP}#${NEW_JBT_JBDS_TP}#g" $d
  sed -i -e "s#<property name='p2.timestamp' value='[0-9]\+'/>#<property name='p2.timestamp' value='${now}'/>#g" $d
  done
  ci "release ${NEW_JBT_JBDS_TP} to http://download.jboss.org/jbosstools/targetplatforms/jbosstoolstarget/luna/" .
  popd >/dev/null

  # JBDS
  pushd ~/tru/download.jboss.org/jbosstools/targetplatforms/jbdevstudiotarget/luna/
  now=`date +%s000`
  for d in composite*.xml; do
  sed -i -e "s#${OLD_JBT_JBDS_TP}#${NEW_JBT_JBDS_TP}#g" $d
  sed -i -e "s#<property name='p2.timestamp' value='[0-9]\+'/>#<property name='p2.timestamp' value='${now}'/>#g" $d
  done
  ci "release ${NEW_JBT_JBDS_TP} to http://download.jboss.org/jbosstools/targetplatforms/jbdevstudiotarget/luna/" .
  popd >/dev/null

  # JBoss Central
  # CAUTION! DO THIS ONLY IF COMPATIBLE w/ previous .Final release (or last milestone if no Final yet)! 
  # This will make the latest Central site live and could cause update problems if there are incompatibilities (eg., gwt e42 -> gwt e43).
  # you might want to instead update updates/development/luna/central/core/compositeContent.xml to point at a specific TP version
  pushd ~/tru/download.jboss.org/jbosstools/targetplatforms/jbtcentraltarget/luna/
  now=`date +%s000`
  for d in composite*.xml; do
  sed -i -e "s#${OLD_CENTRAL_TP}#${NEW_CENTRAL_TP}#g" $d
  sed -i -e "s#<property name='p2.timestamp' value='[0-9]\+'/>#<property name='p2.timestamp' value='${now}'/>#g" $d
  done
  ci "release ${NEW_CENTRAL_TP} to http://download.jboss.org/jbosstools/targetplatforms/jbosstoolstarget/luna/" .
  popd >/dev/null

  gw2;gw3;gw4
  popd >/dev/null

  # push updated target platforms to production
  scpr ~/tru/download.jboss.org/jbosstools/targetplatforms/jbosstoolstarget/luna/composite*.xml $TOOLS/targetplatforms/jbosstoolstarget/luna/
  scpr ~/tru/download.jboss.org/jbosstools/targetplatforms/jbdevstudiotarget/luna/composite*.xml $TOOLS/targetplatforms/jbdevstudiotarget/luna/
  scpr ~/tru/download.jboss.org/jbosstools/targetplatforms/jbtcentraltarget/luna/composite*.xml $TOOLS/targetplatforms/jbtcentraltarget/luna/
  # Ensure that the following files exist and are correct
  echo " >> http://download.jboss.org/jbosstools/targetplatforms/jbosstoolstarget/luna/compositeArtifacts.xml"
  echo " >> http://download.jboss.org/jbosstools/targetplatforms/jbdevstudiotarget/luna/compositeArtifacts.xml"
  echo " >> http://download.jboss.org/jbosstools/targetplatforms/jbtcentraltarget/luna/compositeArtifacts.xml"
  echo " >> http://download.jboss.org/jbosstools/updates/development/luna/central/core/compositeArtifacts.xml"


9. Update composite site metadata (absolute path), Central directory file (absolute path, from http://download.jboss.org/jbosstools/discovery/development/${version}/), and 
             index.html files (absolute paths). Also pull a copy of the updated discovery jar (from http://download.jboss.org/jbosstools/discovery/development/${version}/plugins/).

  previous=4.2.0.Beta1
  version=4.2.0.Alpha1
  version2=4.2.0.Alpha1 # no a, b, c if renamed above 

  cd ~/tru/download.jboss.org/jbosstools/updates/development/luna/
  branch=master; topic="release-development-${version2}"; gw1

  now=`date +%s000`
  for d in composite*.xml; do
  sed -i -e "s#${previous}#${version2}#g" $d
  sed -i -e "s#<property name='p2.timestamp' value='[0-9]\+'/>#<property name='p2.timestamp' value='${now}'/>#g" $d
  done

  rm -f index.html; wget -nc http://download.jboss.org/jbosstools/updates/JBossTools-${version2}.core/index.html
  sed -i -e "s#href=\"#href=\"http://download.jboss.org/jbosstools/updates/JBossTools-${version2}.core/#g" -e "s#href=\"http://download.jboss.org/jbosstools/updates/JBossTools-${version2}.core/http#href=\"http#g" index.html
  
  # update XML
  version=4.2.0.Alpha1
  cd ~/tru/download.jboss.org/jbosstools/updates/development/luna/
  rm -f jbosstools-directory.xml; wget -nc http://download.jboss.org/jbosstools/discovery/development/${version}/jbosstools-directory.xml
  #newJar=plugins/org.jboss.tools.central.discovery_1.0.0.v20120612-0053-H99-Final.jar
  newJar=$(cat jbosstools-directory.xml | grep entry | sed -e "s#.\+plugins/#plugins/#g" | sed -e "s#\.jar.\+#.jar#g"); echo $newJar
  mkdir -p ~/tru/download.jboss.org/jbosstools/updates/development/luna/plugins
  pushd ~/tru/download.jboss.org/jbosstools/updates/development/luna/plugins >/dev/null
  wget http://download.jboss.org/jbosstools/discovery/development/${version}/${newJar}
  popd >/dev/null
  
  # IF THIS IS pre-Final, ensure that your plugin points to the STAGING URL, not the RELEASE one:
  unzip -q -d ~/tru/download.jboss.org/jbosstools/updates/development/luna/${newJar}{_,}
  pushd ~/tru/download.jboss.org/jbosstools/updates/development/luna/${newJar}_ >/dev/null 
  sed -i "s#http://download.jboss.org/jbosstools/updates/stable/luna/central/core/#http://download.jboss.org/jbosstools/updates/development/luna/central/core/#g" plugin.xml
  zip -u ~/tru/download.jboss.org/jbosstools/updates/development/luna/${newJar} plugin.xml
  popd >/dev/null
  rm -fr ~/tru/download.jboss.org/jbosstools/updates/development/luna/${newJar}_

  # IF THIS IS Final, ensure that your plugin points to the RELEASE URL, not the STAGING one:
  #unzip -q -d ~/tru/download.jboss.org/jbosstools/updates/development/luna/${newJar}{_,}
  #pushd ~/tru/download.jboss.org/jbosstools/updates/development/luna/${newJar}_ >/dev/null 
  #sed -i "s#http://download.jboss.org/jbosstools/updates/development/luna/central/core/#http://download.jboss.org/jbosstools/updates/stable/luna/central/core/#g" plugin.xml
  ## *** make sure we do not point at http://download.jboss.org/jbosstools/discovery/development/${version} instead
  #zip -u ~/tru/download.jboss.org/jbosstools/updates/development/luna/${newJar} plugin.xml
  #popd >/dev/null
  #rm -fr ~/tru/download.jboss.org/jbosstools/updates/development/luna/${newJar}_

  # check in / sync changes - 4 updated files, 1 new jar, 1 deleted jar
  stat .; gd .
  # TODO: only add the new jar + updated directory.xml if this is Alpha/Beta/CR toward a .0.Final, or Beta/CR toward a .x.Final (skip Alphas toward maintenance .x.Final)
  git add ${newJar}
  ci "release ${version2} to http://download.jboss.org/jbosstools/updates/development/luna/; add new discovery plugin ${newJar} + update jbosstools-directory.xml" .
  gw2;gw3;gw4
  scpr ~/tru/download.jboss.org/jbosstools/updates/development/luna/* $TOOLS/updates/development/luna/

  # Make sure directory.xml points at a real jar:
  #   http://download.jboss.org/jbosstools/updates/development/luna/jbosstools-directory.xml 
  #   -> http://download.jboss.org/jbosstools/updates/development/luna/plugins/org.jboss.tools.central.discovery_4.2.0.Alpha1-v20131212-1621-B10.jar
  firefox \
    http://download.jboss.org/jbosstools/updates/development/luna/ \
    http://download.jboss.org/jbosstools/updates/development/luna/compositeArtifacts.xml \
    http://download.jboss.org/jbosstools/updates/development/luna/central/core/compositeArtifacts.xml \
    http://download.jboss.org/jbosstools/updates/development/luna/jbosstools-directory.xml \
    http://download.jboss.org/jbosstools/updates/development/luna/${newJar}
  # ensure jar's plugin.xml points at to http://download.jboss.org/jbosstools/updates/development/luna/central/core/
  bc ~/tmp/${newJar/plugins\//} ~/tmp

# If this is the Final build, ensure that the following files exist (copy content from /development/luna/ so that both the milestone and the release have nearly the same content):
  firefox \
    http://download.jboss.org/jbosstools/updates/stable/luna/ \
    http://download.jboss.org/jbosstools/updates/stable/luna/compositeArtifacts.xml \
    http://download.jboss.org/jbosstools/updates/stable/luna/central/core/compositeArtifacts.xml \
    http://download.jboss.org/jbosstools/updates/stable/luna/jbosstools-directory.xml \
    http://download.jboss.org/jbosstools/updates/stable/luna/${newJar}

  # and push new/updated files to server too
  scpr ~/tru/download.jboss.org/jbosstools/updates/stable/* $TOOLS/updates/stable/
  # "gw1" uses special aliases/scripts/shortcuts. Basically, we want to follow correct github workflows so that commits are pushed to user's fork, then later pull-requested (and the p-r applied)
  branch=master; topic="release-stable-${version2}"; gw1
  ci "release ${version} to http://download.jboss.org/jbosstools/updates/stable/luna/; add new discovery plugin ${newJar} + update jbosstools-directory.xml" .
  gw2;gw3;gw4
  
----

9. Review changes:

a. files on SF

  https://sourceforge.net/projects/jboss/files/JBossTools/JBossTools4.2.0.x/

c. magnolia pages

  https://www.jboss.org/author/tools/download
  https://www.jboss.org/author/tools/download/dev
  https://www.jboss.org/author/tools/download/stable
  https://www.jboss.org/author/tools/download/installation/update_4_2 (not created yet)

----

10. Publish magnolia pages

  https://www.jboss.org/author/

--------------------------------------------

11. Update Eclipse Marketplace (add/remove features)

  ** OMIT THIS UNTIL ALPHA 3 or BETA 1 **

  Compare list of features here:  http://download.jboss.org/jbosstools/updates/JBossTools-4.2.0.Alpha1.core/site.properties (see CoreTools.category.features)
  with features here:       https://marketplace.eclipse.org/node/xxxxxx/edit

  Currently, there are ?? features:

org.hibernate.eclipse.feature,
org.jboss.ide.eclipse.archives.feature,
org.jboss.ide.eclipse.as.feature,
org.jboss.ide.eclipse.freemarker.feature,
org.jboss.tools.cdi.deltaspike.feature,
org.jboss.tools.cdi.feature,
org.jboss.tools.cdi.seam.feature,
org.jboss.tools.common.jdt.feature,
org.jboss.tools.community.central.feature,
org.jboss.tools.community.project.examples.feature,
org.jboss.tools.forge.feature,
org.jboss.tools.foundation.feature,
org.jboss.tools.foundation.security.linux.feature,
org.jboss.tools.jmx.feature,
org.jboss.tools.jsf.feature,
org.jboss.tools.jst.feature,
org.jboss.tools.livereload.feature,
org.jboss.tools.maven.apt.feature,
org.jboss.tools.maven.cdi.feature,
org.jboss.tools.maven.feature,
org.jboss.tools.maven.hibernate.feature,
org.jboss.tools.maven.jbosspackaging.feature,
org.jboss.tools.maven.jdt.feature,
org.jboss.tools.maven.portlet.feature,
org.jboss.tools.maven.profiles.feature,
org.jboss.tools.maven.project.examples.feature,
org.jboss.tools.maven.seam.feature,
org.jboss.tools.maven.sourcelookup.feature,
org.jboss.tools.openshift.egit.integration.feature,
org.jboss.tools.openshift.express.feature,
org.jboss.tools.portlet.feature,
org.jboss.tools.project.examples.feature,
org.jboss.tools.richfaces.feature,
org.jboss.tools.runtime.core.feature,
org.jboss.tools.runtime.seam.detector.feature,
org.jboss.tools.seam.feature,
org.jboss.tools.stacks.core.feature,
org.jboss.tools.usage.feature,
org.jboss.tools.vpe.browsersim.feature,
org.jboss.tools.vpe.feature,
org.jboss.tools.ws.feature,
org.jboss.tools.ws.jaxrs.feature,
org.jboss.tools.wtp.runtimes.tomcat.feature,

Be sure to also update the listing to the latest release version (eg., CR1 -> Final)

12. Commit updates to release guide (including this document):

  version=4.2.0.Alpha1
  cd ~/truu/doc/release_guide
  topic="release-${version}";branch=master; gw1
  ci "update release guide for ${version}" JBT42*
  gw2;gw3;gw4

13. tag git

  # if not already cloned, the do this:
  git clone https://github.com/jbosstools/jbosstools-build
  git clone https://github.com/jbosstools/jbosstools-build-ci
  git clone https://github.com/jbosstools/jbosstools-build-sites
  git clone https://github.com/jbosstools/jbosstools-devdoc
  git clone https://github.com/jbosstools/jbosstools-discovery
  git clone https://github.com/jbosstools/jbosstools-download.jboss.org
  git clone https://github.com/jbosstools/jbosstools-maven-plugins

  # now tag multiple projects in a single step, replacing existing tags if already exist
  jbt_branch=jbosstools-4.2.0.Alpha1x
  version=4.2.0.Alpha1
  for d in build build-ci build-sites devdoc discovery download.jboss.org maven-plugins; do
    echo "====================================================================="
    echo "Tagging jbosstools-${d} from branch ${jbt_branch} as tag ${version}..."
    pushd ~/tru/jbosstools-${d}
    git stash
    git pull origin
    git fetch -t -p
    git checkout ${jbt_branch} && git tag -f jbosstools-${version} && git push origin jbosstools-${version}
    git checkout master; git stash pop
    echo ">>> https://github.com/jbosstools/jbosstools-${d}/tree/jbosstools-${version}"
    popd >/dev/null 
    echo "====================================================================="
    echo ""
  done

15. Send email, prepare blogs & announcements

== EMAIL TEMPLATE -- send two emails ==

1. To:
"jbosstools-dev@lists.jboss.org" <jbosstools-dev@lists.jboss.org>

2. To:
jbds-pm-list <jbds-pm-list@redhat.com>
"external-exadel-list@redhat.com" <external-exadel-list@redhat.com>
jboss-announce@redhat.com (optional for major milestones/releases)

version=4.2.0.Alpha1
echo "
Subject:

JBoss Tools ${version} is available

Body:

JBoss Tools ${version} is now available.

This is a development release aimed at Eclipse 4.4 (Luna M3) users.

Eclipse Marketplace:

https://marketplace.eclipse.org/content/jboss-tools-luna

Update Site:

http://download.jboss.org/jbosstools/updates/development/luna/

Installation + Download Pages:

http://www.jboss.org/tools/download
http://www.jboss.org/tools/download/dev/4_2_x
http://www.jboss.org/tools/download/installation/update_4_2


JBoss Central:

This release includes changes to JBoss Central. To see these updates, launch Eclipse with this extra -vmarg in your eclipse.ini:

  -Djboss.discovery.directory.url=http://download.jboss.org/jbosstools/updates/development/luna/jbosstools-directory.xml

--

New + Noteworthy:

Subject to change, the latest N&N is here:

http://htmlpreview.github.com/?https://raw.github.com/jbosstools/jbosstools-documentation/master/whatsnew/index.html
  and
http://docs.jboss.org/tools/whatsnew/

--

Schedule / Upcoming Releases:

https://issues.jboss.org/browse/JBIDE#selectedTab=com.atlassian.jira.plugin.system.project%3Aversions-panel
"

== EMAIL TEMPLATE -- send one email ==

1. To:
"jbosstools-dev@lists.jboss.org" <jbosstools-dev@lists.jboss.org>

version1=jbosstools-4.2.0.Alpha1x
version2=jbosstools-4.2.0.Alpha1

echo "
Subject:

ACTION REQUIRED: Project leads, please tag your projects [ branch ${version1} -> tag ${version2} ] 

Body:

Project leads, please tag your projects!

  co ${version1}
  git tag ${version2}
  git push origin ${version2}

You do not need to reply to this email. Simply comment in this JIRA when tagging is complete:

https://issues.jboss.org/browse/JBIDE-16317 (replace with correct JIRA #)

"
